<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Facebookauthdemo by Lethrir</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Facebookauthdemo</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/Lethrir/FacebookAuthDemo" class="btn">View on GitHub</a>
      <a href="https://github.com/Lethrir/FacebookAuthDemo/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Lethrir/FacebookAuthDemo/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
<a id="welcome-to-vht-facebook-auth-demo" class="anchor" href="#welcome-to-vht-facebook-auth-demo" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Welcome to VHT Facebook Auth Demo</h3>

<p>This page will help authorize Navigator with your Facebook account</p>

App Secret: <input type="text" id="app_secret" />

<fb:login-button scope="public_profile,email,publish_actions,user_posts" onlogin="checkLoginState();">
</fb:login-button>

<br />

Result:
<textarea id="oauth_result">
  
</textarea>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Lethrir/FacebookAuthDemo">Facebookauthdemo</a> is maintained by <a href="https://github.com/Lethrir">Lethrir</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

<script>
  var appId = '1362394403791601';
  window.fbAsyncInit = function() {
    FB.init({
      appId      : appId,
      xfbml      : true,
      version    : 'v2.8'
    });
    FB.AppEvents.logPageView();
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));

  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      if (response.status === 'connected') {
        send_facebook_oauth_code(response.authResponse.accessToken);
      }
      else {
        FB.login(function(r) {
          console.log('Login response: ' + JSON.stringify(r));
          if (r.status === 'connected') {
            // Logged into your app and Facebook.
            
          } else if (r.status === 'not_authorized') {
            // The person is logged into Facebook, but not your app.
          } else {
            // The person is not logged into Facebook, so we're not sure if
            // they are logged into this app or not.
          }
        });
      }
    });
  }

  function send_facebook_oauth_code(access_token) {
    var secret = document.getElementById('app_secret').value;
    var url = 'https://graph.facebook.com/oauth/access_token?grant_type=fb_exchange_token&client_id='+appId+'&client_secret='+secret+'&fb_exchange_token=' + access_token;
    console.log(url);
    get(url, null, function (res) {
      textArea = document.getElementById('oauth_result');
      textArea.innerText = res;
      console.log(res);
    });
    
    return true;
  }

  function request(type, url, data, callback) {
    var xhr = new XMLHttpRequest(),
        fd;

    if (typeof opts === 'function') {
      callback = opts;
      opts = null;
    }

    xhr.open(type, url);

    if (type === 'POST') {
      xhr.setRequestHeader("Content-type", "application/json");
      fd = JSON.stringify(data);
    }

    xhr.onload = function () {
      callback(xhr.responseText);
    };

    if (type === 'POST') {
      xhr.send(fd);
    } else {
      xhr.send();
    }
  }

  var get = request.bind(this, 'GET');
  var post = request.bind(this, 'POST');

</script>
  
  </body>
</html>